<!DOCTYPE html>
<html lang="en">
<head>
    <title>Shower Presentation Engine</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="shower/themes/ribbon/styles/styles.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.5/styles/default.min.css">
    <style>
        .shower {
            --slide-ratio: calc(16 / 9);
        }
    </style>
    <script src="https://unpkg.com/react@16/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js" crossorigin></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.5/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>
<body class="shower list">
    <header class="caption">
        <h1>О Virtual DOM начистоту</h1>
    </header>

    <section class="slide slide_title">
        <h2>О Virtual DOM начистоту</h2>
        <style>
            .slide_title {
                display: flex;
                justify-content: center;
                align-items: center;
            }

            .slide_title h2 {
                font-size: 70px;
            }
        </style>
    </section>

    <section class="slide me">
        <h2 class='bottom'>Реш Артём</h2>
        <svg xmlns="http://www.w3.org/2000/svg" width="72" height="18" viewBox="0 0 96 24">
            <path fill="currentColor" fill-rule="evenodd" d="M34.183 6.476s-1.89-1.495-4.198-1.495c-1.522 0-2.306.86-2.306 1.812 0 3.124 9.918 2.128 9.918 9.736 0 4.075-3.46 7.471-8.995 7.471-5.537 0-8.304-2.717-8.304-2.717l2.767-4.483s2.538 2.219 5.537 2.219c1.753 0 2.768-.905 2.768-2.038 0-3.396-9.919-2.49-9.919-9.736C21.451 3.17 24.681 0 29.755 0c4.474 0 7.104 2.264 7.104 2.264l-2.676 4.212zm18.684 0S50.975 4.98 48.669 4.98c-1.522 0-2.306.86-2.306 1.812 0 3.124 9.917 2.128 9.917 9.736 0 4.075-3.46 7.471-8.995 7.471-5.535 0-8.303-2.717-8.303-2.717L41.75 16.8s2.537 2.219 5.535 2.219c1.753 0 2.768-.905 2.768-2.038 0-3.396-9.918-2.49-9.918-9.736C40.135 3.17 43.364 0 48.438 0c4.475 0 7.105 2.264 7.105 2.264l-2.676 4.212zm18.683 0S69.66 4.98 67.352 4.98c-1.522 0-2.307.86-2.307 1.812 0 3.124 9.92 2.128 9.92 9.736 0 4.075-3.461 7.471-8.997 7.471s-8.304-2.717-8.304-2.717l2.768-4.483s2.538 2.219 5.536 2.219c1.753 0 2.768-.905 2.768-2.038 0-3.396-9.918-2.49-9.918-9.736C58.818 3.17 62.048 0 67.122 0c4.474 0 7.104 2.264 7.104 2.264L71.55 6.476zM11.764 24c4.382 0 6.227-1.585 6.227-1.585v-5.886s-1.614 1.81-5.305 1.81c-3.69 0-6.458-2.716-6.458-6.339 0-3.622 2.768-6.34 6.458-6.34 3.691 0 5.305 1.811 5.305 1.811V1.585S16.146 0 11.764 0C5.306 0 0 5.208 0 12s5.306 12 11.764 12zm72.334-13.177h2.307c2.076 0 3.229-1.132 3.229-2.808 0-1.675-1.153-2.807-3.23-2.807h-2.306v5.615zM96 23.32h-6.735l-4.198-8.377h-.97v8.377h-5.996V.68h9.365C92.4.68 95.63 3.85 95.63 7.7c0 5.388-4.75 6.565-4.75 6.565L96 23.321z"/>
        </svg>
        <figure>
            <img class="cover" src="pictures/me.jpg" alt="мем 'Poker Face'">
        </figure>
        <style>
            .me {
                display: flex;
                flex-direction: column;
                align-items: flex-end;
            }
            .me.slide::after {
                content: none;
            }

            .me img {
                top: 0;
                left: 0;
                transform: translate(0, 0);
            }

            .me .bottom {
                margin-top: auto;
                margin-bottom: 0px;
                color: #000;
            }

            .me svg {
              margin-bottom: 40px;
            }
        </style>
    </section>

    <section class="slide slide_title">
        <h2>Что такое VirtualDOM?</h2>
    </section>

    <section class="slide">
        <figure>
            <img class="cover fade-in" src="pictures/vzuh.png" alt="Мем 'Вжух и готово'">
        </figure>
        <style>
            .fade-in {
              opacity: 0;
              transition: opacity 1000ms linear;
            }

            .slide.active .fade-in{
              opacity: 1;
            }
        </style>
    </section>

    <section class="slide">
        <figure>
            <img class="cover" src="pictures/VirtualDOM.png" alt="VirtualDOM определение из документации React">
        </figure>
    </section>

    <section class="slide">
        <figure>
            <img class="cover" src="pictures/poker_face.jpg" alt="мем 'Poker Face'">
        </figure>
    </section>

    <section class="slide slide_title">
        <h2>Почему возникла потребность в VirtualDOМ?</h2>
        <style>
            .slide_title {
                text-align: center;
            }
        </style>
    </section>

    <section class="slide webkit-engine-working-process">
        <figure>
            <img class="cover" src="pictures/browser_working_process_scheme_1.png" alt="Схема работы браузеров на движке webkit">
        </figure>
        <figure class='next'>
            <img class="cover" src="pictures/browser_working_process_scheme_2.png" alt="Схема работы браузеров на движке webkit">
        </figure>
        <figure class='next'>
            <img class="cover" src="pictures/browser_working_process_scheme_3.png" alt="Схема работы браузеров на движке webkit">
        </figure>
        <figure class='next'>
            <img class="cover" src="pictures/browser_working_process_scheme_4.png" alt="Схема работы браузеров на движке webkit">
        </figure>
        <figure class='next'>
            <img class="cover" src="pictures/browser_working_process_scheme_5.png" alt="Схема работы браузеров на движке webkit">
        </figure>
        <figure class='next'>
            <img class="cover" src="pictures/browser_working_process_scheme_6.png" alt="Схема работы браузеров на движке webkit">
        </figure>
        <figure class='next'>
            <img class="cover" src="pictures/browser_working_process_scheme_7.png" alt="Схема работы браузеров на движке webkit">
        </figure>

        <style>
            .shower.full .webkit-engine-working-process img{
                background-color: white;
            }
        </style>
    </section>

    <section class="slide">
        <h2>Простой документ</h2>
        <pre class="html">
            <code>&lt;!DOCTYPE html&gt;</code>
            <code>&lt;html lang="en"&gt;</code>
            <code>&lt;head&gt;&lt;/head&gt;</code>
            <code>&lt;body&gt;</code>
            <code>    &lt;ul class="list"&gt;</code>
            <code>        &lt;li class="list-item"&gt;Элемент списка&lt;/li&gt;</code>
            <code>    &lt;/ul&gt;</code>
            <code>&lt;/body&gt;</code>
        </pre>
        <style>
            code {
                font-size: 18px;
            }
        </style>
    </section>

    <section class="slide">
        <h2>Простой документ</h2>
        <pre class="javascript">
            <code class='next'>const listItemOne = document.getElementsByClassName("list-item")[0];</code>
            <code class='next'>listItemOne.textContent = "Элемент списка 1";</code>
            <code class='next'> </code>
            <code class='next'>const listItemTwo = document.createElement("li");</code>
            <code class='next'>listItemTwo.classList.add("list-item");</code>
            <code class='next'>listItemTwo.textContent = "Элемент списка 2";</code>
            <code class='next'> </code>
            <code class='next'>const list = document.getElementsByClassName("list")[0];</code>
            <code class='next'>list.appendChild(listItemTwo);</code>
        </pre>
    </section>

    <section class="slide">
        <h2>Простой документ</h2>
        <pre class="javascript">
            <code>const list = document.getElementsByClassName("list")[0];</code>
            <code>list.innerHTML = `</code>
            <code>    &lt;li class="list-item"&gt;Элемент списка 1&lt;/li&gt;</code>
            <code>    &lt;li class="list-item"&gt;Элемент списка 2&lt;/li&gt;</code>
            <code>`;</code>
        </pre>
    </section>

    <section class="slide dom-manipulations">
        <div class="columns two">
            <div>
                <h2>Хорошо</h2>
                <ul class="list_one">
                  <li class="list-item">Элемент списка</li>
                </ul>
                <button onClick='addCodeGoodPracrice()'>
                  Добавить элемент
                </button>

            </div>

            <ul class="list">
                <h2>Плохо</h2>
                <ul class="list_two">
                  <li class="list-item">Элемент списка</li>
                </ul>
                <button onClick='addCodeBadPracrice()'>
                  Добавить элемент
                </button>
            </ul>
        </div>
        <script src="scripts/dom-manipulations.js"></script>
    </section>

    <section class="slide">
        <figure>
            <img class="cover" src="pictures/superhero.png" alt="мем 'Superman'">
        </figure>
    </section>

    <section class="slide slide_title">
        <h2>Механизм работы VirtualDOМ</h2>
    </section>

    <!-- Так что вот такая JSX разметка:
    Будет преобразована к следующему виду: -->

    <section class="slide code-compare">
        <h2>Преобразование JSX</h2>
        <div class="columns two">
            <pre class="html">
                <code>&lt;ul className="list"&gt;</code>
                <code>    &lt;li className="list-item"&gt;Элемент списка&lt;/li&gt;</code>
                <code>&lt;/ul&gt;</code>
            </pre>
            <pre class="javascript next">
                <code><mark class='next'>React.createElement(</mark></code>
                <code>    <mark class='next'>'ul',</mark></code>
                <code>    <mark class='next'>{ className: 'list' },</mark></code>
                <code>    <mark class='next'>React.createElement(</mark></code>
                <code>        <mark class='next'>'li',</mark></code>
                <code>        <mark class='next'>{ className: 'list-item' },</mark></code>
                <code>        <mark class='next'>'Элемент списка'</mark></code>
                <code>    <mark class='next'>)</mark></code>
                <code><mark class='next'>);</mark></code>
            </pre>
        </div>
        <style>
            .code-compare pre code {
                font-size: 14px;
            }

            .shower.full .code-compare .next.active mark.next {
                visibility: visible;
                background: none;
            }

            .shower.full .code-compare .next.active mark.next.active  {
                background: var(--color-yellow);
            }
        </style>
    </section>

    <section class="slide">
        <h2>Вставляем компоненты в DOM</h2>
        <pre class="javascript long-code">
            <code>ReactDOM.render(</code>
            <div class='next'>
                <code>    React.createElement(</code>
                <code>        'ul',</code>
                <code>        { className: 'list' },</code>
                <code>        React.createElement(</code>
                <code>            'li',</code>
                <code>            { className: 'list-item' },</code>
                <code>            'Элемент списка'</code>
                <code>        )</code>
                <code>    ),</code>
            </div>
            <div class='next'>
                <code>    document.getElementById('react-list')</code>
                <code>);</code>
            </div>

        </pre>
        <style>
            pre.long-code code {
                font-size: 14px;
            }
        </style>
    </section>

    <section class="slide code-compare">
        <h2>Oбъект VirtualDOM</h2>
        <div class="columns two">
            <pre class="javascript">
                <code>{</code>
                <code>    type: 'ul',</code>
                <code>    props: {</code>
                <code>        className: 'list',</code>
                <code>        children: [{</code>
                <code>            type: 'li',</code>
                <code>            props: {</code>
                <code>                className: 'list-item', </code>
                <code>                children: ['Элемент списка']</code>
                <code>            }</code>
                <code>        }]</code>
                <code>    }</code>
                <code>}</code>
            </pre>
            <pre class="html next">
                <code>&lt;ul class="list"&gt;</code>
                <code>    &lt;li class="list-item"&gt;Элемент списка&lt;/li&gt;</code>
                <code>&lt;/ul&gt;</code>
            </pre>
        </div>
    </section>

    <section class="slide code-compare">
        <h2>1 сценарий</h2>
        <div class="columns two">
            <pre class="javascript">
                <code>{</code>
                <code>    type: 'li',</code>
                <code>    props: {</code>
                <code>        className: 'list-item', </code>
                <code>        children: ['Элемент списка']</code>
                <code>    }</code>
                <code>}</code>
            </pre>
            <pre class="javascript">
                <code>{</code>
                <code>    type: 'li',</code>
                <code>    props: {</code>
                <code>        className: 'list-item', </code>
                <code>        children: ['Элемент списка']</code>
                <code>    }</code>
                <code>}</code>
            </pre>
        </div>
    </section>

    <section class="slide code-compare">
        <h2>2 сценарий</h2>
        <div class="columns two">
            <pre class="javascript">
                <code>{</code>
                <code>    type: 'li',</code>
                <code>    props: {</code>
                <code>        className: 'list-item', </code>
                <code>        children: ['Элемент списка']</code>
                <code>    }</code>
                <code>}</code>
            </pre>
            <pre class="javascript">
                <code>{</code>
                <code>    type: 'li',</code>
                <code>    props: {</code>
                <code>        className: 'list-item', </code>
                <code>        children: [<mark>'Элемент списка 1'</mark>]</code>
                <code>    }</code>
                <code>}</code>
            </pre>
        </div>
    </section>

    <section class="slide code-compare">
        <h2>3 сценарий</h2>
        <div class="columns two">
            <pre class="javascript">
                <code>{</code>
                <code>    type: 'li',</code>
                <code>    props: {</code>
                <code>        className: 'list-item', </code>
                <code>        children: ['Элемент списка']</code>
                <code>    }</code>
                <code>}</code>
            </pre>
            <pre class="javascript">
                <code>{</code>
                <code>    type: <mark>'span'</mark>,</code>
                <code>    props: {</code>
                <code>        className: 'list-item', </code>
                <code>        children: ['Элемент списка']</code>
                <code>    }</code>
                <code>}</code>
            </pre>
        </div>
    </section>

    <section class="slide code-compare">
        <h2>4 сценарий</h2>
        <div class="columns two">
            <pre class="javascript">
                <code>{</code>
                <code>    type: <mark>ListItem</mark>,</code>
                <code>    props: {</code>
                <code>        children: ['Элемент списка']</code>
                <code>    }</code>
                <code>}</code>
            </pre>
        </div>
    </section>

    <section class="slide react-list">
        <div id='react-list'></div>
        <script>
            'use strict';

            const e = React.createElement;

            class List extends React.Component {
                constructor(props) {
                    super(props);
                    this.state = { elements: ['Элемент списка'] };
                    this.handleAddListItem = this.handleAddListItem.bind(this);
                    this.handleRemoveListItem = this.handleRemoveListItem.bind(this);
                }

                handleAddListItem() {
                    this.setState({
                      elements: this.state.elements.concat('Элемент списка')
                    });
                }

                handleRemoveListItem() {
                    this.setState({
                      elements: this.state.elements.slice(0, -1)
                    });
                }

                render() {
                    return e(
                        "div",
                        { className: "columns two" },
                        e(
                            "ul",
                            { className: "list" },
                            this.state.elements.map(function(item, index) {
                                return e(
                                    "li",
                                    { key: index },
                                    item,
                                    ' ',
                                    index + 1,
                                )
                            })
                        ),
                        e(
                            "div",
                            { className: "controls" },
                            e("button", { onClick: this.handleAddListItem }, "Добавить элемент" ),
                            e("button", { onClick: this.handleRemoveListItem }, "Убрать элемент" )
                        )
                    );
                }
            }

            class App extends React.Component {
                render() {
                    return e(
                        "div",
                        null,
                        e("h2", null, "Список"),
                        e(List, null)
                    );
                }
            }

            ReactDOM.render(e(App), document.getElementById('react-list'))

        </script>
        <style>
            .react-list .controls {
                display: flex;
                flex-wrap: wrap;
                flex-direction: column;
            }
            .react-list button {
                padding: 16px 24px;
                font-size: 20px;
                width: 100%;
                height: 56px;
                background: none;
                flex-grow: 0;
            }

            .react-list button:first-of-type {
                margin-bottom: 16px;
            }

            .react-list .counter {
                margin-left: auto;
                margin-right: auto;
                display: flex;
                align-items: center;
                flex-wrap: wrap;
                width: 96px;
                transform: scale(2);
            }

            .react-list .counter div:first-of-type {
                display: flex;
                align-items: center;
                justify-content: center;
                width: 96px;
                height: 48px;
            }
        </style>
    </section>

    <section class="slide counter-react-dom-flowchart">
        <figure>
            <img class="cover" src="pictures/UntitledDiagramPage_1.png" alt="Диаграмма DOM дерева Cчетчика">
        </figure>
        <figure class='next'>
            <img class="cover" src="pictures/UntitledDiagramPage_2.png" alt="Диаграмма DOM дерева Cчетчика">
        </figure>
        <figure class='next'>
            <img class="cover" src="pictures/UntitledDiagramPage_3.png" alt="Диаграмма DOM дерева Cчетчика">
        </figure>
        <figure class='next'>
            <img class="cover" src="pictures/UntitledDiagramPage_4.png" alt="Диаграмма DOM дерева Cчетчика">
        </figure>
        <style>
            .shower.full .counter-react-dom-flowchart img{
                background-color: white;
                object-fit: cover;
            }
        </style>
    </section>

    <section class="slide code-compare">
        <h2>Узкие места</h2>
        <div class="columns two">
            <pre class="html">
                <code>if(canSeeList) {</code>
                <code>   return &lt;div&gt;</code>
                <code>       &lt;List /&gt;</code>
                <code>       &lt;AnotherOneComponent /&gt;</code>
                <code>   &lt;/div&gt;</code>
                <code>} else {</code>
                <code>   return &lt;div&gt;</code>
                <code>       &lt;AnotherOneComponent /&gt;</code>
                <code>   &lt;/div&gt;</code>
                <code>}</code>
            </pre>
            <pre class="html next">
                <code>&lt;div&gt;</code>
                <code>    { canSeeList && &lt;List /&gt; }</code>
                <code>    &lt;AnotherOneComponent /&gt;</code>
                <code>&lt;/div&gt;</code>
            </pre>
        </div>
    </section>

    <section class="slide code-compare">
        <h2>PureComponent и React.Memo</h2>
        <pre class="javascript">
          <code>class List extends React.PureComponent {</code>
          <code>    render() {</code>
          <code>        /* render using props */</code>
          <code>    }</code>
          <code>}</code>
        </pre>

        <pre class="javascript">
            <code>const MemoList = React.memo(function List(props)</code>
            <code>    /* render using props */</code>
            <code>});</code>
        </pre>
    </section>

    <section class="slide code-compare">
        <h2>Узкие места</h2>
        <div class="columns two">
            <pre class="html">
                <code>&lt;List</code>
                <code>    items={<mark class='next'>items.map(...)</mark>}</code>
                <code>    listOptions={<mark class='next'>{bullets: 'square'}</mark>}</code>
                <code>    onItemClick={<mark class='next'>() => {...}</mark>}</code>
                <code>&gt;</code>
            </pre>
        </div>
    </section>

    <section class="slide slide_title">
        <h2>Подведём итоги</h2>
    </section>

    <section class="slide">
        <h2>Альтернативы</h2>
        <ul>
            <li><a href="https://lit-html.polymer-project.org/">Lit-html</a></li>
            <li class="next"><a href="https://viperhtml.js.org/hyper.html">hyperHtml</a></li>
            <li class="next"><a href="http://imba.io/guides/advanced/performance#performance">Memoized DOM</a></li>
            <li class="next"><a href="https://developer.mozilla.org/ru/docs/DOM/DOM_Reference">DOM</a><img</li>
        </ul>
    </section>

    <section class="slide">
        <h2>Полезные ссылки</h2>
        <ul>
            <li><a href="https://medium.freecodecamp.org/the-virtual-dom-is-slow-meet-the-memoized-dom-bb19f546cc52">подробней о Memoized DOM</a></li>
            <li>
                <a href="https://scrimba.com/p/c6B9rAM">скринкаст о imba</a> — языке программирования, который использует технологию Memoized DOM
            </li>
            <li>
                <a href="https://medium.com/@abraztsov/how-virtual-dom-work-567128ed77e9">отличная статья</a>, подробно рассказывает о том, как устроен и работает VDOM
            </li>
            <li>
                <a href="https://www.html5rocks.com/ru/tutorials/internals/howbrowserswork/">большая статья</a>, о том, как работают браузеры.
            </li>
            <li>
                <a href="https://evilmartians.com/chronicles/optimizing-react-virtual-dom-explained">статья о VirtualDOM</a> от Злых Марсиан
            </li>
        </ul>
    </section>

    <div class="progress"></div>

    <script src="shower/shower.min.js"></script>
    <!-- Copyright © 2018 Yours Truly, Famous Inc. -->
</body>
</html>
